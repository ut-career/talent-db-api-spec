openapi: 3.0.2
info:
  description: |
    人材DBサービスAPI

    - [Repository](https://github.com/ut-career/talent-db-api)
  title: 人材DB
  version: 0.0.1
servers:
  - url: http://localhost:8080
tags:
  - description: 認証
    name: auth
  - description: 提供者
    name: supplier
  - description: 閲覧者
    name: viewer
  - description: 人材
    name: talent
security:
  - api_key: []
paths:
  /auth/supplier:
    post:
      tags: [auth]
      summary: 認証
      description: 認証し、ユーザーを返却します
      operationId: auth_supplier
      x-openapi-router-controller: src.controllers.auth_controller
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AuthRequest"
      responses:
        200:
          description: 認証成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Supplier"
        400:
          description: 認証失敗
        401:
          $ref: "#/components/responses/UnauthorizedError"
  /auth/viewer:
    post:
      tags: [auth]
      summary: 認証
      description: 認証し、ユーザーを返却します
      operationId: auth_viewer
      x-openapi-router-controller: src.controllers.auth_controller
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AuthRequest"
      responses:
        200:
          description: 認証成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Viewer"
        400:
          description: 認証失敗
        401:
          $ref: "#/components/responses/UnauthorizedError"
    put:
      tags: [auth]
      summary: ユーザー登録
      description: ユーザー登録
      operationId: register_viewer
      x-openapi-router-controller: src.controllers.auth_controller
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Viewer"
      responses:
        201:
          description: 登録成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Viewer"
        400:
          description: 登録失敗
        401:
          $ref: "#/components/responses/UnauthorizedError"
  /auth/talent:
    post:
      tags: [auth]
      summary: 認証
      description: 認証し、ユーザーを返却します。
      operationId: auth_talent
      x-openapi-router-controller: src.controllers.auth_controller
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AuthRequest"
      responses:
        200:
          description: 認証成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Talent"
        400:
          description: 認証失敗
        401:
          $ref: "#/components/responses/UnauthorizedError"
    put:
      tags: [auth]
      summary: ユーザー登録
      description: ユーザー登録
      operationId: register_talent
      x-openapi-router-controller: src.controllers.auth_controller
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AuthRequest"
      responses:
        201:
          description: 登録成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Talent"
        400:
          description: 登録失敗
        401:
          $ref: "#/components/responses/UnauthorizedError"
  /auth/talent:sendEmailVerification:
    post:
      tags: [auth]
      summary: 認証
      description: ユーザーにアドレス確認メールを送信
      operationId: send_email_verification_to_talent
      x-openapi-router-controller: src.controllers.auth_controller
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AuthRequest"
      responses:
        202:
          description: アドレス確認メールの送信依頼を受理しました。
        400:
          description: 認証失敗
        401:
          $ref: "#/components/responses/UnauthorizedError"
  /auth/talent:changeEmail:
    post:
      tags: [auth]
      summary: メールアドレス変更
      operationId: change_email_for_talent
      x-openapi-router-controller: src.controllers.auth_controller
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ChangeEmailRequest"
      responses:
        200:
          description: OK
        400:
          description: 認証失敗
        401:
          $ref: "#/components/responses/UnauthorizedError"

  /viewers/{viewer_id}:
    get:
      tags: [viewer]
      summary: 閲覧者取得
      description: 閲覧者取得
      operationId: findById
      x-openapi-router-controller: src.controllers.viewer_controller
      parameters:
        - name: viewer_id
          in: path
          required: true
          schema:
            type: string
      responses:
        200:
          description: 取得成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Viewer"
        401:
          $ref: "#/components/responses/UnauthorizedError"
        404:
          description: not found

  /suppliers/{supplier_id}/talents:
    get:
      tags: [supplier]
      summary: 閲覧者取得
      description: 閲覧者取得
      operationId: supplier_get_talents
      x-openapi-router-controller: src.controllers.supplier_controller
      parameters:
        - $ref: "#/components/parameters/page"
        - $ref: "#/components/parameters/limit"
        - name: supplier_id
          in: path
          required: true
          schema:
            type: string
      responses:
        200:
          description: 取得成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Talents"
        401:
          $ref: "#/components/responses/UnauthorizedError"
        404:
          description: not found

  /talents:
    get:
      tags: [talent]
      summary: 人材取得
      description: 人材取得
      operationId: findTalents
      x-openapi-router-controller: src.controllers.talent_controller
      parameters:
        - $ref: "#/components/parameters/page"
        - $ref: "#/components/parameters/limit"
        - name: desired_industry
          in: query
          required: false
          schema:
            type: string
        - name: objective
          in: query
          required: false
          schema:
            type: string
        - name: preferred_work_location
          in: query
          required: false
          schema:
            type: string
        - name: desired_salary
          in: query
          required: false
          schema:
            type: integer
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Talents"
        401:
          $ref: "#/components/responses/UnauthorizedError"

    post:
      tags: [talent]
      summary: 人材登録
      description: 人材登録
      operationId: add_talent
      x-openapi-router-controller: src.controllers.talent_controller
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Talent"
      responses:
        201:
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Talent"
        401:
          $ref: "#/components/responses/UnauthorizedError"

  /talents/{talent_id}:
    get:
      tags: [talent]
      summary: 人材取得
      description: 人材取得
      operationId: find_talent
      x-openapi-router-controller: src.controllers.talent_controller
      parameters:
        - $ref: "#/components/parameters/talent_id"
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Talent"
        401:
          $ref: "#/components/responses/UnauthorizedError"
        404:
          description: not found
    post:
      tags: [talent]
      summary: 人材更新
      description: 人材更新
      operationId: update_talent
      x-openapi-router-controller: src.controllers.talent_controller
      parameters:
        - $ref: "#/components/parameters/talent_id"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/TalentUpdate"
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Talent"
        401:
          $ref: "#/components/responses/UnauthorizedError"
        404:
          description: not found

  /talents/{talent_id}/contacts:
    post:
      tags: [talent]
      summary: コンタクト作成
      description: コンタクト作成
      operationId: create_contact
      x-openapi-router-controller: src.controllers.talent_controller
      parameters:
        - $ref: "#/components/parameters/talent_id"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ContactCreate"
      responses:
        201:
          description: OK
        400:
          description: bad request
        401:
          $ref: "#/components/responses/UnauthorizedError"
        404:
          description: not found

  /talents/{talent_id}/contacts/{contact_id}:
    get:
      tags: [talent]
      summary: コンタクト取得
      description: コンタクト取得
      operationId: find_contact
      x-openapi-router-controller: src.controllers.talent_controller
      parameters:
        - $ref: "#/components/parameters/talent_id"
        - name: contact_id
          in: path
          required: true
          schema:
            $ref: "#/components/schemas/uuid"
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Contact"
        401:
          $ref: "#/components/responses/UnauthorizedError"
        404:
          description: not found

components:
  securitySchemes:
    api_key:
      type: apiKey
      name: x-api-key
      in: header
      x-apikeyInfoFunc: src.controllers.auth_controller.decode_api_key
  parameters:
    page:
      name: page
      description: page
      in: query
      required: false
      schema:
        $ref: "#/components/schemas/page"
    limit:
      name: limit
      description: limit
      in: query
      required: false
      schema:
        $ref: "#/components/schemas/limit"
    talent_id:
      name: talent_id
      in: path
      required: true
      schema:
        $ref: "#/components/schemas/uuid"

  responses:
    UnauthorizedError:
      description: API KEY is missing or invalid
  schemas:
    page:
      type: integer
      default: 1
      example: 3
      minimum: 1
    limit:
      type: integer
      default: 25
      example: 50
      minimum: 0
      maximum: 200
    uuid:
      type: string
      format: uuid
      description: uuid
      example: "12rRjru478DDjdht8h33k"
    user_id:
      type: string
      description: uid
      example: "5EBsIVfaq6XDXAjUjjvhTSxIvpa2"
    user_name:
      type: string
      example: "dummy name"
    email:
      type: string
      format: email
      writeOnly: true
      example: "hoge@hoge.com"
    password:
      type: string
      format: password
      writeOnly: true
      example: "secret"
    year_month:
      type: string
      pattern: '^\d{4}-\d{2}$'
      example: "2010-04"
    AuthRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          $ref: "#/components/schemas/email"
        password:
          $ref: "#/components/schemas/password"
    ChangeEmailRequest:
      allOf:
        - $ref: "#/components/schemas/AuthRequest"
        - type: object
          required:
            - email_new
          properties:
            email_new:
              $ref: "#/components/schemas/email"
    Paging:
      type: object
      properties:
        page:
          $ref: "#/components/schemas/page"
        limit:
          $ref: "#/components/schemas/limit"
        total:
          type: integer
          minimum: 0
          example: 249
    Supplier:
      type: object
      required:
        - name
      properties:
        id:
          readOnly: true
          $ref: "#/components/schemas/user_id"
        name:
          $ref: "#/components/schemas/user_name"
        email:
          $ref: "#/components/schemas/email"
        password:
          $ref: "#/components/schemas/password"
    Viewer:
      type: object
      required:
        - name
      properties:
        id:
          readOnly: true
          $ref: "#/components/schemas/user_id"
        name:
          $ref: "#/components/schemas/user_name"
        email:
          $ref: "#/components/schemas/email"
        password:
          $ref: "#/components/schemas/password"
    Family:
      type: object
      properties:
        name:
          type: string
          example: UT 花子
        relationship:
          type: string
          description: 続柄
          example: 妻
    Certification:
      type: object
      required:
        - name
      properties:
        name:
          type: string
          example: 普通自動車免許
        acquired_year_month:
          $ref: "#/components/schemas/year_month"
    Education:
      type: object
      required:
        - name
        - enrollment_year_month
      properties:
        name:
          type: string
          example: "UT大学"
        enrollment_year_month:
          $ref: "#/components/schemas/year_month"
        graduation_year_month:
          $ref: "#/components/schemas/year_month"
        category:
          type: string
          example: 大学
        course:
          type: string
          example: 経営学部経営学科
        humanism_or_science:
          type: string
          description: 文系理系
          example: 理系
    StudentDays:
      type: object
      properties:
        self_pr:
          type: string
          description: 自己PR
          example: |
            高校では
            これこれこうこう
            大学では
            これこれだいだい
            ・
        hardest_tried:
          type: string
          description: 力をいれたこと
          example: |
            私はこれこれに
            力をいれました
            ・
        work_experience:
          type: string
          description: 就業経験
          example: |
            私はこんな就業を
            何年やりました
            ・
        difficulty:
          type: string
          description: 困難と感じた経験
          example: |
            私はこれで困難を感じた
            そのときこうして乗り越えた
            ・
        strong_and_weak:
          type: string
          description: 長所・短所
          example: |
            長所はこれこれ
            短所はこれこれ
            ・
    Resume:
      type: object
      required:
        - company_name
      properties:
        company_name:
          type: string
          example: UT・キャリア
        joined_year_month:
          $ref: "#/components/schemas/year_month"
        leaved_year_month:
          $ref: "#/components/schemas/year_month"
        busuiness_detail:
          type: string
          description: 事業内容
          example: 有料職業紹介
        number_of_employees:
          type: integer
          example: 300
        employment_type:
          type: string
          description: 雇用形態
          example: 正社員
        section:
          type: string
          description: 部署
          example: システム部
        position:
          type: string
          description: 役職
          example: 部長
        industry:
          type: string
          description: 業種
          example: 人材
        job:
          type: string
          description: 職種
          example: 営業
        description:
          type: string
          description: 業務内容
          example: |
            既存の法人に対しての営業を行っていました。
            営業時には以下のようなことを意識していました。
            ・
            ・
            ・
    CV:
      type: object
      description: 職務経歴
      properties:
        summary:
          type: string
          description: 職歴要約
          example: 新卒で営業を3年行い、その後転職してWebマーケティングを5年
        detail:
          type: array
          default: []
          items:
            $ref: "#/components/schemas/Resume"
    Talent:
      type: object
      required:
        - email
      properties:
        id:
          $ref: "#/components/schemas/uuid"
        supplier_id:
          $ref: "#/components/schemas/user_id"
        name:
          type: string
          example: UT 太郎
        name_kana:
          type: string
          description: 氏名ふりがな
          example: ゆーてぃー たろう
        email:
          type: string
          format: email
          example: "hoge@hoge.com"
        phone_number:
          type: string
          example: "08004859483"
        sex:
          type: string
          nullable: true
          enum:
            - 男性
            - 女性
            - その他
          example: 男性
        birthday:
          type: string
          format: date
          example: "1993-09-14"
        zip_code:
          type: string
          pattern: "^[0-9]{7}$"
          description: 郵便番号
          example: "1050003"
        prefecture:
          type: string
          description: 都道府県名
          example: 東京都
        prefecture_kana:
          type: string
          readOnly: true
          description: 都道府県名ふりがな
          example: とうきょうと
        city:
          type: string
          description: 市区町村
          example: 港区
        city_kana:
          type: string
          description: 市区町村ふりがな
          example: みなとく
        address_line1:
          type: string
          description: 番地等
          example: 5-134
        address_line1_kana:
          type: string
          description: 番地等ふりがな
          example: 5-134
        address_line2:
          type: string
          description: 建物名、部屋番号
          example: UTビル21階
        address_line2_kana:
          type: string
          description: 建物名、部屋番号ふりがな
          example: ゆーてぃーびる21かい
        last_annual_salary:
          type: integer
          description: 直近年収
          example: 6000000
        dependent_families:
          type: array
          default: []
          items:
            $ref: "#/components/schemas/Family"
        has_spouse:
          type: boolean
          default: null
          example: true
        certifications:
          type: array
          default: []
          items:
            $ref: "#/components/schemas/Certification"
        educations:
          type: array
          default: []
          items:
            $ref: "#/components/schemas/Education"
        cv:
          $ref: "#/components/schemas/CV"
        student_days:
          type: object
          properties:
            detail:
              $ref: "#/components/schemas/StudentDays"
        desired_industries:
          type: array
          description: 希望業界
          default: []
          items:
            type: string
          example: ["IT・通信・インターネット", "商社"]
        objectives:
          type: array
          description: 希望職種
          default: []
          items:
            type: string
          example: ["法人営業", "社内SE"]
        preferred_work_locations:
          type: array
          description: 希望勤務地
          default: []
          items:
            type: string
          example: ["東京都", "神奈川県"]
        commutable_time:
          type: string
          description: 通勤可能時間
          example: 30分
        desired_salary:
          type: integer
          description: 希望年収
          example: 6000000
        publish_begin_date:
          type: string
          format: date
          description: 掲載開始日
          example: "2020-07-01"
        publish_end_date:
          type: string
          format: date
          description: 掲載終了日
          default: "2099-12-31"
          example: "2020-07-01"
    TalentUpdate:
      type: object
      properties:
        name:
          type: string
          example: UT 太郎
        name_kana:
          type: string
          description: 氏名ふりがな
          example: ゆーてぃー たろう
        phone_number:
          type: string
          example: "08004859483"
        sex:
          type: string
          enum:
            - 男性
            - 女性
            - その他
          example: 男性
        birthday:
          type: string
          format: date
          example: "1993-09-14"
        zip_code:
          type: string
          pattern: "^[0-9]{7}$"
          description: 郵便番号
          example: "1050003"
        prefecture:
          type: string
          description: 都道府県名
          example: 東京都
        city:
          type: string
          description: 市区町村
          example: 港区
        city_kana:
          type: string
          description: 市区町村ふりがな
          example: みなとく
        address_line1:
          type: string
          description: 番地等
          example: 5-134
        address_line1_kana:
          type: string
          description: 番地等ふりがな
          example: 5-134
        address_line2:
          type: string
          description: 建物名、部屋番号
          example: UTビル21階
        address_line2_kana:
          type: string
          description: 建物名、部屋番号ふりがな
          example: ゆーてぃーびる21かい
        last_annual_salary:
          type: integer
          description: 直近年収
          example: 6000000
        dependent_families:
          type: array
          items:
            $ref: "#/components/schemas/Family"
        has_spouse:
          type: boolean
          default: null
          example: true
        certifications:
          type: array
          default: []
          items:
            $ref: "#/components/schemas/Certification"
        educations:
          type: array
          items:
            $ref: "#/components/schemas/Education"
        student_days:
          $ref: "#/components/schemas/StudentDays"
        cv:
          $ref: "#/components/schemas/CV"
        desired_industries:
          type: array
          description: 希望業界
          items:
            type: string
          example: ["IT・通信・インターネット", "商社"]
        objectives:
          type: array
          description: 希望職種
          items:
            type: string
          example: ["法人営業", "社内SE"]
        preferred_work_locations:
          type: array
          description: 希望勤務地
          items:
            type: string
          example: ["東京都", "神奈川県"]
        commutable_time:
          type: string
          description: 通勤可能時間
          example: 30分
        desired_salary:
          type: integer
          description: 希望年収
          example: 6000000
        publish_begin_date:
          type: string
          format: date
          description: 掲載開始日
          example: "2020-07-01"
        publish_end_date:
          type: string
          format: date
          description: 掲載終了日
          default: "2099-12-31"
          example: "2020-07-01"

    Talents:
      type: object
      properties:
        paging:
          $ref: "#/components/schemas/Paging"
        talents:
          type: array
          default: []
          items:
            $ref: "#/components/schemas/Talent"

    ContactCreate:
      type: object
      required:
        - viewer_id
        - title
        - message
      properties:
        viewer_id:
          $ref: "#/components/schemas/user_id"
        title:
          type: string
          example: コンタクト件名例
        message:
          type: string
          example: コンタクトメッセージ内容例
    Contact:
      type: object
      required:
        - id
        - talent
        - viewer_id
        - title
        - message
        - status
        - send_datetime
        - send_count
      properties:
        id:
          $ref: "#/components/schemas/uuid"
        talent:
          $ref: "#/components/schemas/Talent"
        viewer_id:
          $ref: "#/components/schemas/user_id"
        title:
          type: string
          example: コンタクト件名例
        message:
          type: string
          example: コンタクトメッセージ内容例
        status:
          type: string
          enum:
            - 未読
            - 打診中
            - 応募済み
            - 辞退
          example: 打診中
        send_datetime:
          type: string
          format: date-time
          example: "2020-09-10T09:12:28Z"
        send_count:
          description: コンタクト回数
          type: integer
          example: 1
